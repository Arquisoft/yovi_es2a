ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]
== Vista de Bloques

ifdef::arc42help[]
[role="arc42help"]

.Contenido
La vista de bloques muestra la descomposición estática del sistema en bloques de construcción así como sus dependencias.

endif::arc42help[]

=== Sistema General de Caja Blanca (Nivel 1)

En este nivel se presenta la descomposición de más alto nivel del sistema Yovi, mostrando cómo interactúa con los usuarios y los sistemas externos.

[plantuml, target=diagrama-contexto, format=svg]
....
@startuml
actor "Jugador Humano" as User
actor "Bot Externo" as Bot
component "Sistema Yovi" as System
database "MongoDB" as DB

User --> System : HTTPS (Navegador)
Bot --> System : API REST
System --> DB : Protocolo NoSQL
@enduml
....

==== Motivación
El sistema Yovi está diseñado para permitir la gestión y ejecución de partidas del juego "Y" en un entorno web. La arquitectura debe soportar concurrencia y dos tipos de actores principales:

Usuarios Humanos: Que requieren una interfaz gráfica interactiva.

Bots: Que requieren una API para automatizar el juego.

==== Bloques de construcción contenidos

[cols="1,2" options="header"]
|===
| Nombre | Responsabilidad
| Sistema Yovi | El núcleo del proyecto. Es la caja negra que contiene toda la lógica de presentación, negocio y reglas del juego.
| Usuario (Actor) | Jugador humano que interactúa con el sistema a través de un navegador web moderno.
| Bot Externo (Actor) | Sistema automatizado que consume la API pública para jugar partidas contra la máquina o contra humanos.
| Base de Datos (MongoDB) | Sistema externo encargado de la persistencia de usuarios, historiales de partidas, rankings y estadísticas. Base de datos no relacional.
|===

==== Interfaces Importantes

Interfaz Web (HTTPS): Acceso para usuarios humanos.

API Pública (REST/JSON): Acceso programático para los bots y comunicación interna.

=== Nivel 2

ifdef::arc42help[]
[role="arc42help"]

Aquí se especifica la estructura interna del bloque principal "Sistema Yovi".

endif::arc42help[]

==== Caja Blanca: Sistema Yovi

Esta vista explota el sistema en sus contenedores principales, separando la presentación de la lógica de negocio y los datos.

[plantuml, target=diagrama-contenedores, format=svg]
....
@startuml
component "Frontend Web" as Front
component "Backend API" as Back
component "Motor de Juego (Game Engine)" as Engine

Front --> Back : API REST / WebSockets
Back --> Engine : Llamadas a funciones
@enduml
....

Motivación:
Se ha optado por una arquitectura cliente-servidor desacoplada para permitir que la interfaz web evolucione independientemente de la lógica y para facilitar la integración de los bots directamente contra el Backend.

Bloques de construcción contenidos:

[cols="1,2" options="header"]
|===
| Nombre | Responsabilidad
| Frontend Web | Aplicación de Página Única (SPA). Renderiza el tablero de juego y gestiona la interacción del usuario.
| Backend API | Servidor de aplicaciones. Gestiona la autenticación, matchmaking, persistencia y orquesta el flujo de la partida.
| Motor de Juego (Game Engine) | Librería o módulo puro. Contiene estrictamente las reglas del juego "Y", validación de movimientos y detección de victoria.
|===

==== Frontend Web

Propósito: Proveer una interfaz visual amigable para los jugadores humanos.

Interfaces: Consume la API REST del Backend y utiliza WebSockets para actualizaciones en tiempo real.

Tecnología: HTML5/JS (React/Angular/Vue).

==== Backend API

Propósito: Centralizar la lógica de negocio y seguridad. Actúa como intermediario entre los actores, la base de datos y el motor de reglas.

Interfaces: Expone endpoints REST y WebSockets para el gameplay.

Tecnología: Node.js / Java Spring Boot.

==== Motor de Juego (Game Engine)

Propósito: Encapsular la complejidad algorítmica del juego "Y". Asegura que las reglas se cumplan rigurosamente.

Características: Módulo independiente, testeable unitariamente y sin estado.

=== Nivel 3

ifdef::arc42help[]
[role="arc42help"]

Aquí especificamos la estructura interna del Backend API, detallando sus componentes internos.

endif::arc42help[]

==== Caja Blanca: Backend API

El Backend se organiza siguiendo un patrón de capas (Controller - Service - Repository) para mantener el código limpio y mantenible.

[plantuml, target=diagrama-componentes, format=svg]
....
@startuml
package "Backend API" {
[Game Controller] --> [Matchmaking Service]
[Game Controller] --> [Game Service]
[User Controller] --> [User Service]

[Game Service] ..> [Motor de Juego] : usa
[Matchmaking Service] --> [Game Service] : inicia

[Game Service] --> [Persistence Layer]
[User Service] --> [Persistence Layer]
}
@enduml
....

Bloques de construcción contenidos:

[cols="1,2" options="header"]
|===
| Nombre | Responsabilidad
| Game Controller | Gestiona las peticiones de red (HTTP/Sockets) relacionadas con el juego.
| User Controller | Gestiona el registro, login y perfil de usuario.
| Matchmaking Service | Lógica para emparejar jugadores en espera o asignar un Bot si es necesario.
| Game Service | Orquestador de la partida. Mantiene el estado en memoria y valida movimientos con el Motor de Juego.
| Persistence Layer | Capa de abstracción (DAO/Repository) para comunicar con MongoDB.
|===

==== Game Service

Propósito: Cerebro de la ejecución. Recibe intentos de movimiento, consulta validez al motor, actualiza el estado y notifica a los jugadores.

Colaboradores: Motor de Juego, Persistence Layer.

==== Matchmaking Service

Propósito: Gestionar la cola de jugadores. Instancia nuevos juegos a través del Game Service cuando se cumplen las condiciones de emparejamiento.

==== Persistence Layer

Propósito: Aislar las consultas y el mapeo de datos de MongoDB del resto de la lógica de negocio.